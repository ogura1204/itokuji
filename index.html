<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ç”ºå®¶ã®æ—¥ AR (æ‰‹æŒã¡é…ç½®ç‰ˆ)</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      /* æ“ä½œãƒ‘ãƒãƒ« */
      #ui-layer {
        position: fixed; bottom: 0; left: 0; width: 100%; height: 25%;
        background: rgba(0,0,0,0.6);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999;
      }

      /* é…ç½®ç¢ºå®šãƒœã‚¿ãƒ³ */
      #place-btn {
        background: #dc3545; color: white;
        padding: 12px 40px; border: none; border-radius: 30px;
        font-weight: bold; font-size: 18px; margin-bottom: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      }
      
      /* èª¿æ•´ãƒœã‚¿ãƒ³ç¾¤ */
      .ctrl-row { display: flex; gap: 15px; margin-bottom: 5px; }
      .ctrl-btn {
        background: white; border: 1px solid #ccc;
        padding: 8px 15px; border-radius: 5px; font-weight: bold;
      }
      .ctrl-btn:active { background: #ddd; }

      /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
      #status-msg {
        position: fixed; top: 10px; left: 0; width: 100%;
        text-align: center; color: yellow; font-weight: bold;
        text-shadow: 1px 1px 2px black; pointer-events: none; z-index: 9998;
      }
    </style>
  </head>
  
  <body>
    <div id="status-msg">ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>

    <div id="ui-layer">
        <div class="ctrl-row">
            <button class="ctrl-btn" onclick="changeScale(0.5)">ç¸®å°</button>
            <button class="ctrl-btn" onclick="changeScale(2.0)">æ‹¡å¤§</button>
            <button class="ctrl-btn" onclick="changeDist(0.5)">é ãã¸</button>
            <button class="ctrl-btn" onclick="changeDist(-0.5)">è¿‘ãã¸</button>
        </div>
        <button id="place-btn" onclick="togglePlace()">ğŸ“ ã“ã“ã«å›ºå®šã™ã‚‹</button>
        <div style="color:white; font-size:10px; margin-top:5px;" onclick="window.open('https://lykke-hygge-2.myshopify.com/', '_blank');">Shop Link</div>
    </div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      renderer="colorManagement: true; physicallyCorrectLights: true;">

      <a-assets>
        <a-asset-item id="model-glb" src="./model2.glb"></a-asset-item>
      </a-assets>

      <a-camera id="camera" position="0 0 0" near="0.01" far="10000">
          
          <a-entity id="ar-content" position="0 -0.5 -3" scale="0.5 0.5 0.5">
              
              <a-box color="red" position="0 2 0" scale="0.5 0.5 0.5" 
                     animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
              
              <a-entity position="0 3.5 0" scale="2 2 2">
                  <a-plane color="black" opacity="0.6" width="2" height="0.8"></a-plane>
                  <a-text value="2026.8 OPEN" align="center" width="6" position="0 0.1 0.1"></a-text>
                  <a-text value="GRAND OPEN" align="center" color="gold" width="4" position="0 -0.1 0.1"></a-text>
              </a-entity>

              <a-entity id="my-model" gltf-model="#model-glb"></a-entity>

          </a-entity>
      </a-camera>

      <a-light type="ambient" color="#ffffff" intensity="1.5"></a-light>
      <a-light type="directional" color="#ffffff" intensity="1.5" position="0 10 0"></a-light>

    </a-scene>

    <script>
      const content = document.getElementById('ar-content');
      const camera = document.getElementById('camera');
      const scene = document.querySelector('a-scene');
      const btn = document.getElementById('place-btn');
      const statusMsg = document.getElementById('status-msg');

      let isPlaced = false;

      // 1. å›ºå®šãƒ»è§£é™¤ã®åˆ‡ã‚Šæ›¿ãˆ
      function togglePlace() {
          if (!isPlaced) {
              // ã€å›ºå®šã™ã‚‹å‡¦ç†ã€‘
              // ç¾åœ¨ã®ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã‚’å–å¾—
              const worldPos = new THREE.Vector3();
              const worldRot = new THREE.Quaternion();
              const worldScale = new THREE.Vector3();
              
              content.object3D.getWorldPosition(worldPos);
              content.object3D.getWorldQuaternion(worldRot);
              content.object3D.getWorldScale(worldScale);

              // ã‚«ãƒ¡ãƒ©ã‹ã‚‰åˆ‡ã‚Šé›¢ã—ã¦ã€ã‚·ãƒ¼ãƒ³ç›´ä¸‹ã«ç§»å‹•
              content.parentNode.removeChild(content);
              scene.appendChild(content);

              // åº§æ¨™ã‚’å†é©ç”¨
              content.object3D.position.copy(worldPos);
              content.object3D.quaternion.copy(worldRot);
              content.object3D.scale.copy(worldScale);

              btn.innerText = "ğŸ”„ æŒã¡é‹ã¶ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰";
              btn.style.background = "#007BFF";
              statusMsg.innerText = "å›ºå®šã—ã¾ã—ãŸã€‚é›¢ã‚Œã¦è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚";
              isPlaced = true;

          } else {
              // ã€æŒã¡é‹ã¶å‡¦ç†ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰ã€‘
              // å†ã³ã‚«ãƒ¡ãƒ©ã®å­è¦ç´ ã«æˆ»ã™
              content.parentNode.removeChild(content);
              camera.appendChild(content);
              
              // åˆæœŸä½ç½®ã«æˆ»ã™
              content.setAttribute('position', '0 -0.5 -3');
              content.setAttribute('rotation', '0 0 0');
              
              btn.innerText = "ğŸ“ ã“ã“ã«å›ºå®šã™ã‚‹";
              btn.style.background = "#dc3545";
              statusMsg.innerText = "ç§»å‹•ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¹ãƒãƒ›ã‚’å‹•ã‹ã™ã¨ã¤ã„ã¦ãã¾ã™";
              isPlaced = false;
          }
      }

      // 2. èª¿æ•´æ©Ÿèƒ½
      function changeScale(ratio) {
          const current = content.object3D.scale;
          content.object3D.scale.set(current.x * ratio, current.y * ratio, current.z * ratio);
          statusMsg.innerText = `ã‚µã‚¤ã‚ºå¤‰æ›´: ${(current.x).toFixed(2)}`;
      }

      function changeDist(val) {
          // å›ºå®šå¾Œã¯å‹•ã‹ã›ãªã„ã‚ˆã†ã«ã™ã‚‹
          if(isPlaced) {
              statusMsg.innerText = "å›ºå®šä¸­ã¯ç§»å‹•ã§ãã¾ã›ã‚“ã€‚ã€ŒæŒã¡é‹ã¶ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„";
              return;
          }
          const current = content.getAttribute('position');
          content.setAttribute('position', {x: current.x, y: current.y, z: current.z - val});
          statusMsg.innerText = `è·é›¢å¤‰æ›´: ${-(current.z - val).toFixed(1)}m å…ˆ`;
      }

      // 3. èª­ã¿è¾¼ã¿ç¢ºèª
      document.querySelector('#model-glb').addEventListener('loaded', () => {
          statusMsg.innerText = "èª­ã¿è¾¼ã¿å®Œäº†ï¼ç”»é¢ã«èµ¤ã„ç®±ã¯è¦‹ãˆã¾ã™ã‹ï¼Ÿ";
      });
      document.querySelector('#model-glb').addEventListener('error', () => {
          statusMsg.innerText = "ã€ã‚¨ãƒ©ãƒ¼ã€‘ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼";
          statusMsg.style.color = "red";
      });
    </script>
  </body>
</html>
