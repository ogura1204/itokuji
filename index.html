<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ç”ºå®¶ã®æ—¥ AR (ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é…ç½®)</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; font-family: sans-serif; }
      
      /* ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
      #place-btn {
        position: fixed; bottom: 15%; left: 50%; transform: translateX(-50%);
        background: #dc3545; color: white;
        padding: 15px 30px; border: none; border-radius: 50px;
        font-weight: bold; font-size: 18px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        z-index: 9999;
      }
      
      #status {
        position: fixed; top: 10px; left: 0; width: 100%;
        text-align: center; color: lime; background: rgba(0,0,0,0.5);
        padding: 5px; z-index: 9998; pointer-events: none;
      }

      #footer-frame { position: fixed; bottom: 0; left: 0; width: 100%; height: 10%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 9999; }
      .f-text { color: white; font-size: 12px; pointer-events: auto; cursor: pointer; padding: 10px; }
    </style>
  </head>
  
  <body>
    <div id="status">AR Ready. ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é…ç½®ã—ã¦ãã ã•ã„</div>
    
    <button id="place-btn" onclick="placeModel()">ğŸ“ ç›®ã®å‰ã«é…ç½®ã™ã‚‹</button>

    <div id="footer-frame"><div class="f-text" onclick="window.open('https://lykke-hygge-2.myshopify.com/', '_blank');">Tap to Open Shop</div></div>

    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
      renderer="colorManagement: true; physicallyCorrectLights: true; toneMapping: ACESFilmic; exposure: 1.0;">

      <a-assets>
        <a-asset-item id="model-glb" src="./model2.glb"></a-asset-item>
      </a-assets>

      <a-camera id="camera" position="0 0 0" look-controls="enabled: false" near="0.01" far="10000">
      </a-camera>

      <a-light type="ambient" color="#ffffff" intensity="1.5"></a-light>
      <a-light type="directional" color="#ffffff" intensity="2.0" position="1 2 1"></a-light>


      <a-entity id="model-container" visible="false" position="0 0 -5">
          
          <a-box color="red" position="-1.5 1 0" scale="0.5 0.5 0.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-box>
          
          <a-entity position="0 4.5 0" scale="2 2 2" look-at="[camera]">
                <a-plane color="black" opacity="0.7" width="2" height="0.8"></a-plane>
                <a-plane color="#C5A059" width="1.8" height="0.02" position="0 -0.2 0.01"></a-plane>
                <a-text value="2026.8 OPEN" align="center" width="6" position="0 0.1 0.05"></a-text>
                <a-text value="GRAND OPEN" align="center" color="#C5A059" width="4" position="0 -0.1 0.05"></a-text>
          </a-entity>

          <a-entity id="my-model"
                    gltf-model="#model-glb" 
                    position="0 0 0" 
                    scale="0.5 0.5 0.5">
          </a-entity>
          
      </a-entity>

    </a-scene>

    <script>
      // ãƒ“ãƒ«ãƒœãƒ¼ãƒ‰å‡¦ç†ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¸¸ã«ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã‚‹ï¼‰
      AFRAME.registerComponent('look-at', {
        schema: { type: 'selector' },
        tick: function () {
          this.el.object3D.lookAt(this.data.object3D.position);
        }
      });

      // é…ç½®ãƒ­ã‚¸ãƒƒã‚¯
      function placeModel() {
          const container = document.getElementById('model-container');
          const camera = document.getElementById('camera');
          const status = document.getElementById('status');
          
          // ã‚«ãƒ¡ãƒ©ã®ç¾åœ¨ã®å›è»¢æƒ…å ±ã‚’å–å¾—ï¼ˆYè»¸å›è»¢ã®ã¿ï¼‰
          const camRot = camera.getAttribute('rotation');
          
          // ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
          container.setAttribute('visible', 'true');
          
          // ã‚«ãƒ¡ãƒ©ã®ã€Œæ­£é¢ã€ã«é…ç½®ã™ã‚‹ãŸã‚ã€å›è»¢ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚«ãƒ¡ãƒ©ã«è¿½å¾“ã•ã›ãªã„
          // AR.jsã®ã‚«ãƒ¡ãƒ©ã¯ä¸–ç•Œåº§æ¨™ã§å‹•ããŸã‚ã€
          // ã€Œä»Šã®ã‚«ãƒ¡ãƒ©ã®ä½ç½®ã€ã¨ã€Œå‘ãã€ã‚’è¨ˆç®—ã—ã¦ã€ãã®5ãƒ¡ãƒ¼ãƒˆãƒ«å…ˆã«ç½®ãã®ãŒæ­£è§£ã§ã™ãŒã€
          // ã‚‚ã£ã¨å˜ç´”ã«ã€Œã‚«ãƒ¡ãƒ©ã®å­è¦ç´ ã€ã¨ã—ã¦è¿½å¾“ã•ã›ã‚‹ã¨ãƒ–ãƒ¬ã‚‹ã®ã§ã€
          // ã“ã“ã§ã¯ã€ŒWorldåº§æ¨™ 0,0,-5ã€ã‚ãŸã‚Šã®åˆæœŸä½ç½®ã«ã€ã‚«ãƒ¡ãƒ©ã®å‘ãã ã‘åˆã‚ã›ã¾ã™ã€‚
          
          // ã‚·ãƒ³ãƒ—ãƒ«ç­–: 
          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå»ºè¨­äºˆå®šåœ°ã®æ–¹ã‚’å‘ã„ã¦ãã ã•ã„ã€ã¨æ€ã‚ã›ã¦ã€
          // ã‚«ãƒ¡ãƒ©ã®ç›®ã®å‰ï¼ˆZè»¸ãƒã‚¤ãƒŠã‚¹æ–¹å‘ï¼‰ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’ç§»å‹•ã•ã›ã‚‹ã€‚
          
          // ã‚«ãƒ¡ãƒ©ã®æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã‚’å–å¾—
          const direction = new THREE.Vector3();
          camera.object3D.getWorldDirection(direction);
          
          // ç¾åœ¨ä½ç½®
          const pos = camera.object3D.position;
          
          // 5ãƒ¡ãƒ¼ãƒˆãƒ«å…ˆ
          const distance = 5;
          const newPos = {
              x: pos.x + direction.x * distance,
              y: pos.y - 1.5, // åœ°é¢ã®é«˜ã•ã¸è£œæ­£
              z: pos.z + direction.z * distance
          };
          
          // ã‚³ãƒ³ãƒ†ãƒŠã‚’ç§»å‹•
          container.setAttribute('position', newPos);
          
          // ãƒ¢ãƒ‡ãƒ«ã®å‘ãã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã‚‹ï¼ˆåˆæœŸåŒ–ï¼‰
          container.setAttribute('rotation', `0 ${camRot.y} 0`);

          status.innerText = "é…ç½®å®Œäº†ï¼å‘¨ã‚Šã‚’è¦‹æ¸¡ã—ã¦ãã ã•ã„";
          
          // ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ãƒã‚§ãƒƒã‚¯
          const model = document.getElementById('my-model');
          if(!model.getObject3D('mesh')) {
              status.innerText += " (ãƒ¢ãƒ‡ãƒ«èª­è¾¼ä¸­...)";
          }
      }
      
      // ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†é€šçŸ¥
      document.querySelector('#model-glb').addEventListener('loaded', () => {
          document.getElementById('status').innerText = "ãƒ‡ãƒ¼ã‚¿èª­è¾¼å®Œäº†ã€‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„";
      });
    </script>
  </body>
</html>
